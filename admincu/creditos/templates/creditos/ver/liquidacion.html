{% extends 'raiz.html' %}
{% load staticfiles %}
{% load humanize %}

{% block titulo %}
  Liquidacion de facturas {{liquidacion.formatoAfip}}
{% endblock %}

{% block breadcrum %}
  {% include 'comunes/breadcrum.html' with bpadre="Recursos" bhijo1="registro de liquidaciones" bhijo2=liquidacion.formatoAfip %}
{% endblock %}

{% block header %}
  Liquidacion de facturas {{liquidacion.formatoAfip}}
{% endblock %}

{% block contenido %}

<div class="row">
  <div class="col-md-12">

    <!-- Tarjetas superiores -->
    <div class="row">
      <div class="col-md-6">
        <div class="card-box widget-box-three ribbon-box">
          <div class="bg-icon pull-left">
            <img src="{% static 'assets/images/icons/rules.svg' %}">
          </div>
          <div class="text-right">
            <p class="m-t-5 text-uppercase font-14 font-600">Creditos liquidados</p>
            <h2 class="m-b-10">{{ creditos_total }}</h2>
          </div>
        </div>
      </div>

      <div class="col-md-6">
        <div class="card-box widget-box-three ribbon-box">
          <div class="bg-icon pull-left">
            <img src="{% static 'assets/images/icons/sales_performance.svg' %}">
          </div>
          <div class="text-right">
            <p class="m-t-5 text-uppercase font-14 font-600">Total</p>
            <h2 class="m-b-10">$ {{ liquidacion.suma_brutos|intcomma }}</h2>
          </div>
        </div>
      </div>
    </div>

    <!-- Tabla -->
    <div class="row">
      <div class="col-md-12">
        <div class="panel panel-border panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Listado de creditos generados</h3>
          </div>

          <div class="panel-body">

            <!-- CONTENEDOR PARA AISLAR ESTA TABLA DE DATATABLES GLOBAL -->
            <div id="liquidacion-wrapper" class="table-responsive">
                {% include 'creditos/registros/tabla-creditos.html' with creditos=creditos %}
            </div>

            <!-- PAGINACIÓN DJANGO -->
            {% include 'comunes/paginador.html' %}
            <div class="text-muted small mt-2">
              Mostrando {{ page_obj.start_index }} – {{ page_obj.end_index }}
              de {{ page_obj.paginator.count }} créditos
              ({{ page_obj.paginator.per_page }} por página)
            </div>          
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

{% endblock %}

{% block js %}

<!-- 1) BLOQUEAMOS EL DATATABLES GLOBAL PARA ESTA TABLA -->
<script>
document.addEventListener("DOMContentLoaded", function() {

    const tabla = document.querySelector("#liquidacion-wrapper table");

    if (tabla) {
        tabla.classList.add("dt-no-init");   // evita inicialización global
        tabla.classList.remove("anopa");     // quita clase que activa DT global
    }

});
</script>

<!-- 2) Incluimos script global (ahora IGNORA esta tabla) -->
{% include 'comunes/js_datatable_print_excel.html' %}

<!-- 3) Inicializamos DataTables SOLO para Excel/Print SIN paginación -->
<script>
document.addEventListener("DOMContentLoaded", function() {

    const tabla = document.querySelector("#liquidacion-wrapper table");
    if (!tabla) return;

    // Si DataTables global tocó algo, destruimos
    if ($.fn.DataTable.isDataTable(tabla)) {
        $(tabla).DataTable().destroy();
    }

    // Inicializamos SOLO BOTONES — sin paging, sin ordering
    $(tabla).DataTable({
        destroy: true,
        dom: "Bfrtip",
        buttons: [
            { extend: "excel", className: "btn-sm" },
            { extend: "print", className: "btn-sm" }
        ],
        paging: false,
        ordering: false,
        searching: false,
        info: false
    });

});
</script>

{% endblock %}



