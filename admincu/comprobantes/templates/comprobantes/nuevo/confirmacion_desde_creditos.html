{% extends extension %}
{% load static %}
{% load humanize %}

{% block panel-body %}
  <div class="card border-0 shadow-sm mb-4">
    <div class="card-header bg-white border-0 pt-3 pb-0">
      <h4 class="mb-1">Confirmación</h4>
      <p class="text-muted mb-0">
        Vas a generar Recibos X para los créditos seleccionados. Revisá los datos y confirmá.
      </p>
    </div>

    <div class="card-body">
      {% if preview %}
        <div class="table-responsive">
          <table class="table table-sm table-striped align-middle mb-0">
            <thead class="thead-light">
              <tr>
                <th>Socio</th>
                <th>Items</th>
              </tr>
            </thead>
            <tbody>
              {% for row in preview %}
                <tr>
                  <td>{{ row.socio }}</td>
                  <td>
                    <ul class="mb-0 pl-3 ps-3">
                      {% for it in row.items %}
                        <li>
                          {{ it.credito.ingreso }} — {{ it.credito.periodo|date:"Y-m" }} — ${{ it.subtotal|intcomma }}
                        </li>
                      {% endfor %}
                    </ul>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% endif %}
    </div>

    <div class="card-footer bg-white border-0">
      <form id="confirm-rcx-form" method="post" class="mb-0">
        {% csrf_token %}
        {{ wizard.management_form }}

      </form>
    </div>
  </div>
{% endblock %}

{% block js %}
  <style>
    /* Compacta la tabla y mejora legibilidad */
    .table th, .table td { vertical-align: middle; }
    .table thead th { font-weight: 600; }
    /* Un poco más de aire entre header, tabla y footer */
    .card-body { padding-top: 1rem; padding-bottom: 1rem; }
    .card-footer .btn { border-radius: .6rem; padding: .5rem 1rem; }
    .gap-2 { gap: .5rem; } /* shim para BS4 */
  </style>

  <script>
    // Evita “submits” duplicados que vengan del layout
    (function(){
      var form = document.getElementById('confirm-rcx-form');
      if (!form) return;
      var keep = document.getElementById('submit-confirm');
      form.querySelectorAll('button[type="submit"],input[type="submit"]').forEach(function(el){
        if (el !== keep) el.style.display = 'none';
      });
    })();
  </script>
{% endblock %}
