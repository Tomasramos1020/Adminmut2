{% extends 'raiz.html' %}
{% load humanize attrs %}

{% block titulo %}{{ nombre_elemento }}{% endblock %}
{% block header %}{{ nombre_elemento }}{% endblock %}

{% block contenido %}
<style>
  .sidebar-doc{ position: sticky; top: 15px; }
  .clamp-3{
    display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden;
  }
  .link-ver{ display:inline-block; font-size:12px; color:#888; }
  .pill { display:inline-block; padding:2px 8px; border-radius:12px; font-size:12px; }
  .pill-on { background:#e8f5e9; color:#2e7d32; border:1px solid #c8e6c9; }
  .pill-off{ background:#fafafa; color:#616161; border:1px solid #e0e0e0; }
</style>

<div class="row">
  <div class="col-md-3">
    <div class="sidebar-doc">
      {% include 'barra_doc.html' with elemento=elemento %}
    </div>
  </div>

  <div class="col-md-9">
    <div class="panel panel-border panel-info">
      <div class="panel-heading">
        <h3 class="panel-title">{{ nombre_elemento }}</h3>
      </div>
      <div class="panel-body">
        <a href="{% url 'doc_crear' modelo=elemento %}" class="btn btn-info pull-right">
          <i class="fa fa-plus"></i> Nuevo
        </a>
        <div class="table-responsive m-t-30">
          <table class="table table-striped">
            <thead>
              <tr>
                <th width="1%"></th>
                {% for f, label in columns %}
                  <th>{{ label }}</th>
                {% endfor %}
              </tr>
            </thead>
            <tbody>
              {% for obj in object_list %}
              <tr>
                <td>
                  <a href="{% url 'doc_instancia' modelo=elemento pk=obj.pk %}" class="btn btn-xs btn-warning">
                    <i class="fa fa-pencil"></i>
                  </a>
                </td>

                {% for f, label in columns %}
                  <td>
                    {% if f == "integrantes" %}
                      {{ obj.integrantes.count|default_if_none:"—" }}

                    {% elif f == "preview" %}
                      {% if long_field %}
                        {% with texto=obj|attrs:long_field %}
                          {% if texto %}
                            <div class="clamp-3">{{ texto|truncatechars:preview_trunc }}</div>
                            <a href="{% url 'doc_instancia' modelo=elemento pk=obj.pk %}" class="link-ver">ver completo</a>
                          {% endif %}
                        {% endwith %}
                      {% endif %}

                    {# Booleans: firma / transcripcion #}
                    {% elif f == "firma" or f == "transcripcion" %}
                      {% with val=obj|attrs:f %}
                        {% if val %}
                          <span class="pill pill-on">Sí</span>
                        {% else %}
                          <span class="pill pill-off">No</span>
                        {% endif %}
                      {% endwith %}

                    {# Fojas: número de foja en actas #}
                    {% elif f == "foja" %}
                      {{ obj.foja|default:"—" }}

                    {% else %}
                      {{ obj|attrs:f|default_if_none:"" }}
                    {% endif %}
                  </td>
                {% endfor %}
              </tr>
              {% empty %}
              <tr>
                <td colspan="{{ columns|length|add:1 }}" class="text-center">Sin registros.</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}


